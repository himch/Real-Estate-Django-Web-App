{% load i18n %}
{% load static %}
{% load l10n %}
{% get_current_language as LANGUAGE_CODE %}


<form method="post" id="post-form-footer">
  {% csrf_token %}
  {% if user.is_authenticated %}
    <input type="hidden" name="user_id" value="{{ user.id }}">
  {% else %}
    <input type="hidden" name="user_id" value="0">
  {% endif %}
  {% trans 'Ask a question' as form_title %}
  <input type="hidden" name="realtor_email" value="{{ listing.realtor.email }}">
  <input type="hidden" name="listing_id" value="{{ listing.id|unlocalize }}">
  <input type="hidden" name="listing" value="{{ listing.title_a_en }}">
  <input type="hidden" name="message" value="Request from: {{ form_title }}">
  <input type="hidden" name="email" placeholder="{% trans 'Email' %}" {% if user.is_authenticated %} value="{{ user.email }}" {% else %} value="None"{% endif %} required="required"/>
  <input type="hidden" name="name" placeholder="{% trans 'Your name' %}" {% if user.is_authenticated %} value="{{ user.first_name }} {{ user.last_name }}" {% else %} value="None" {% endif %} required="required"/>

  <div class="footer__form">
    <div class="footer__form-title">{{ form_title }}</div>
    <div class="footer__form-input w-full">
      <input type="tel" name="phone" placeholder="+9 999 999 99 99" required="required"/>
    </div>
    <button class="p-btn p-btn_white flex flex-ai-center flex-j-center text-500" type="submit" value="Send">{% trans 'Get a consultation' %}<!--Получить консультацию--></button>
      <label class="p-check flex flex-ai-center">
      <input type="checkbox" name="consent_processing_personal_data" checked="checked"/><span class="p-check__square flex flex-j-center flex-ai-center flex-shrink">
        <picture>
          <source type="image/webp" srcset="" data-srcset="/img/main/get/check-white.webp"/><img class="lazy " width="15" height="15" src="" data-src="/img/main/get/check-white.png" alt="" loading="lazy"/>
        </picture></span><span class="p-check__title">{% trans 'By submitting the form, you consent to the processing of personal data' %}<!--Отправляя форму, вы даёте согласие на&nbsp;обработку персональных данных--></span>
    </label>
  </div>
</form>


<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
<script>
$(document).ready(
  $('#post-form-footer').submit(function(e){
    e.preventDefault();
    var serializedData = $(this).serialize();

    $.ajax({
      type:"POST",
      url: "{% url 'contact' %}",
      data:  serializedData,
      success: function(data){
        $("#result").text(data["result"]);
      },
    });
  })
);
</script>